(()=>{"use strict";var e,t="https://js.stripe.com/v3",n=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,r="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",o=function(e){var n=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(t).concat(n);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(r),r},i=null,s=null,a=null,c=!1,l=function(){return e||(e=(c=null,null!==i?i:(i=new Promise((function(e,i){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&c&&console.warn(r),window.Stripe)e(window.Stripe);else try{var l=function(){for(var e=document.querySelectorAll('script[src^="'.concat(t,'"]')),r=0;r<e.length;r++){var o=e[r];if(n.test(o.src))return o}return null}();if(l&&c)console.warn(r);else if(l){if(l&&null!==a&&null!==s){var d;l.removeEventListener("load",a),l.removeEventListener("error",s),null===(d=l.parentNode)||void 0===d||d.removeChild(l),l=o(c)}}else l=o(c);a=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(e,i),s=function(e){return function(){e(new Error("Failed to load Stripe.js"))}}(i),l.addEventListener("load",a),l.addEventListener("error",s)}catch(e){return void i(e)}else e(null)}))).catch((function(e){return i=null,Promise.reject(e)}))).catch((function(t){return e=null,Promise.reject(t)})));var c};Promise.resolve().then((function(){return l()})).catch((function(e){c||console.warn(e)}));const d=(()=>{let e,t,n,r,o,i,s=!1;const a=e=>{const t=`<div class="hb-message message">${e}</div>`;r.insertAdjacentHTML("afterbegin",t),r.scrollIntoView({behavior:"smooth"})};return{init:async()=>{"undefined"==typeof hotel_booking_stripe_params&&console.log("Stripe Setting is not defined"),void 0!==hotel_booking_stripe_params.payment_stripe_via_iframe&&(r=document.getElementById("hotel-booking-payment"),t=document.getElementById("hb-payment-form"),t&&await(async()=>{try{e=await function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];c=!0;var r=Date.now();return l().then((function(e){return function(e,t,n){if(null===e)return null;var r=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"2.3.0",startTime:t})}(r,n),r}(e,t,r)}))}(hotel_booking_stripe_params.publish_key||"");const t={clientSecret:hotel_booking_stripe_params.publishableKey||"",appearance:{}};n=e.elements(t);const r=n.create("payment");r.on("loaderror",(function(e){i=e.error.message})),r.on("ready",(function(e){s=!0})),r.mount("#wphb-stripe-iframe-wrap")}catch(e){i=e.message}})())},events:()=>{t=document.getElementById("hb-payment-form"),t&&t.addEventListener("click",(function(c){const l=c.target;if(l.classList.contains("hb_button")&&"submit"==l.type){const d=l,u=new FormData(t);if("stripe"!==u.get("hb-payment-method"))return;if(c.preventDefault(),!r)return void console.error("Page checkout is not defined");const p=r.querySelectorAll(".hb-message.message");if(p.length>0&&p.forEach((e=>{e.remove()})),void 0!==i)return void a(i);if(void 0===hotel_booking_stripe_params.publishableKey)return void a("Stripe Publish Key is generate failed, please check again config key!");if(!s)return void a("Stripe payment not load done. Please wait!");d.classList.add("wphb_loading"),d.innerText=hotel_booking_stripe_params.button_processing,n.submit().then((function(t){void 0===t.error&&(d.disabled=!0,o=new URL(hotel_settings.ajax),((e,t={})=>{fetch(o,{method:"POST",body:e}).then((e=>e.text())).then((e=>{console.log(e),e=(e=>{if("string"!=typeof e)return e;const t=String.raw({raw:e}).match(/<!-- HB_AJAX_START -->(.*)<!-- HB_AJAX_END -->/s);try{e=t?JSON.parse(t[1].replace(/(?:\r\n|\r|\n)/g,"")):JSON.parse(e)}catch(t){e={}}return e})(e),t.success(e)})).finally((()=>{t.completed()})).catch((e=>t.error(e)))})(u,{before:()=>{},success:t=>{var r,o;console.log(t),"fail"===t.result?(d.disabled=!1,a(t.message)):"success"===t.result&&(r=t.redirect,o=e=>{console.log(e)},void 0===e&&console.log("Stripe is not defined"),void 0===n&&console.log("Stripe form not mounted"),e.confirmPayment({elements:n,confirmParams:{return_url:r}}).then((function(e){o(e)})))},error:e=>{},completed:()=>{}}))}))}}))}}})();document.addEventListener("DOMContentLoaded",(()=>{d.init().then((()=>{}))})),d.events()})();